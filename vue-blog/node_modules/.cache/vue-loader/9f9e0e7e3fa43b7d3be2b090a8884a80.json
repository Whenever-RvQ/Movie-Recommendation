{"remainingRequest":"D:\\githubdesk\\Vue-blog\\vue-blog\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\githubdesk\\Vue-blog\\vue-blog\\src\\components\\Live2d.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\githubdesk\\Vue-blog\\vue-blog\\src\\components\\Live2d.vue","mtime":1762770788308},{"path":"D:\\githubdesk\\Vue-blog\\vue-blog\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\githubdesk\\Vue-blog\\vue-blog\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\githubdesk\\Vue-blog\\vue-blog\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\githubdesk\\Vue-blog\\vue-blog\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQpjb25zdCBNT0RFTF9NQVAgPSB7DQogIDE6ICdsaXZlMmQtd2lkZ2V0LW1vZGVsLWdmJywNCiAgMjogJ2xpdmUyZC13aWRnZXQtbW9kZWwtaGlqaWtpJywNCn0NCg0KY29uc3QgVEVYVFVSRV9NQVAgPSB7DQogIDE6IHsgMDogJ0dhbnR6ZXJ0X0ZlbGl4YW5kZXIubW9kZWwuanNvbicgfSwgLy8g6Iul5pyJ5a6e6ZmF57q555CG5paH5Lu277yM5YaN5pu/5o2i5Li655yf5a6e5paH5Lu25ZCNDQogIDI6IHsgMDogJ2hpamlraS5tb2RlbC5qc29uJyB9DQp9DQoNCmV4cG9ydCBkZWZhdWx0IHsNCiAgbmFtZTogJ0xpdmUyZCcsDQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIG1vZGVsSWQ6IDEsDQogICAgICB0ZXh0dXJlc0lkOiAwLA0KICAgICAgbGl2ZTJkSW5zdGFuY2U6IG51bGwgLy8g5a2Y5YKoIExpdmUyRCDlrp7kvovvvIznlKjkuo7plIDmr4ENCiAgICB9Ow0KICB9LA0KICBtb3VudGVkKCkgew0KICAgIHRoaXMubG9hZExpdmUyZFNjcmlwdCgpLnRoZW4oKCkgPT4gew0KICAgICAgdGhpcy5pbml0TGl2ZTJEKCkNCiAgICB9KS5jYXRjaChlcnIgPT4gew0KICAgICAgY29uc29sZS5lcnJvcignTGl2ZTJE6ISa5pys5Yqg6L295aSx6LSl77yaJywgZXJyKQ0KICAgIH0pDQogIH0sDQogIC8vIOe7hOS7tuWNuOi9veaXtumUgOavgeaooeWei++8jOmBv+WFjeWGheWtmOazhOa8jw0KICBiZWZvcmVVbm1vdW50KCkgew0KICAgIHRoaXMuZGVzdHJveUxpdmUyRCgpDQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICBsb2FkTGl2ZTJkU2NyaXB0KCkgew0KICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsNCiAgICAgICAgaWYgKHdpbmRvdy5sb2FkbGl2ZTJkIHx8IHdpbmRvdy5MMkR3aWRnZXQpIHsNCiAgICAgICAgICByZXNvbHZlKCkNCiAgICAgICAgICByZXR1cm4NCiAgICAgICAgfQ0KICAgICAgICBjb25zdCBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKQ0KICAgICAgICBzY3JpcHQuc3JjID0gJy9zdGF0aWMvbGl2ZTJkdy9saWIvTDJEd2lkZ2V0Lm1pbi5qcycNCiAgICAgICAgc2NyaXB0LnR5cGUgPSAndGV4dC9qYXZhc2NyaXB0Jw0KICAgICAgICBzY3JpcHQuYXN5bmMgPSBmYWxzZQ0KICAgICAgICBzY3JpcHQub25sb2FkID0gKCkgPT4gcmVzb2x2ZSgpDQogICAgICAgIHNjcmlwdC5vbmVycm9yID0gKGVycikgPT4gcmVqZWN0KGVycikNCiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzY3JpcHQpDQogICAgICB9KQ0KICAgIH0sDQoNCiAgICBkZXN0cm95TGl2ZTJEKCkgew0KICAgICAgaWYgKHRoaXMubGl2ZTJkSW5zdGFuY2UpIHsNCiAgICAgICAgLy8g5YW85a655LiN5ZCM54mI5pys55qE6ZSA5q+B5pa55rOVDQogICAgICAgIGlmICh0aGlzLmxpdmUyZEluc3RhbmNlLmRlc3Ryb3kpIHsNCiAgICAgICAgICB0aGlzLmxpdmUyZEluc3RhbmNlLmRlc3Ryb3koKQ0KICAgICAgICB9IGVsc2UgaWYgKHdpbmRvdy5MMkR3aWRnZXQgJiYgd2luZG93LkwyRHdpZGdldC5kZXN0cm95KSB7DQogICAgICAgICAgd2luZG93LkwyRHdpZGdldC5kZXN0cm95KCdsaXZlMmQnKQ0KICAgICAgICB9DQogICAgICAgIHRoaXMubGl2ZTJkSW5zdGFuY2UgPSBudWxsDQogICAgICB9DQogICAgICAvLyDmuIXnqbrnlLvluIPvvIzpgb/lhY3mrovnlZkNCiAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsaXZlMmQnKQ0KICAgICAgaWYgKGNhbnZhcykgew0KICAgICAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKQ0KICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCkNCiAgICAgIH0NCiAgICB9LA0KDQogICAgaW5pdExpdmUyRCgpIHsNCiAgICAgIC8vIOWFiOmUgOavgeaXp+aooeWei++8jOWGjeWIneWni+WMluaWsOaooeWei++8iOaguOW/g+S/ruWkje+8iQ0KICAgICAgdGhpcy5kZXN0cm95TGl2ZTJEKCkNCg0KICAgICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xpdmUyZCcpDQogICAgICBpZiAoIWNhbnZhcykgew0KICAgICAgICBjb25zb2xlLmVycm9yKCfmnKrmib7liLBMaXZlMkTnlLvluIPvvIEnKQ0KICAgICAgICByZXR1cm4NCiAgICAgIH0NCg0KICAgICAgY29uc3QgbW9kZWxGb2xkZXIgPSBNT0RFTF9NQVBbdGhpcy5tb2RlbElkXQ0KICAgICAgY29uc3QgdGV4dHVyZUZpbGUgPSBURVhUVVJFX01BUFt0aGlzLm1vZGVsSWRdW3RoaXMudGV4dHVyZXNJZF0NCiAgICAgIGNvbnN0IG1vZGVsQ29uZmlnUGF0aCA9IGAvcHVibGljL3N0YXRpYy9saXZlMmR3LyR7bW9kZWxGb2xkZXJ9L2Fzc2V0cy8ke3RleHR1cmVGaWxlfWANCg0KDQogICAgICBjb25zb2xlLmxvZyhg5b2T5YmN5Yqg6L295qih5Z6L77yaSUQ9JHt0aGlzLm1vZGVsSWR977yM6Lev5b6EPSR7bW9kZWxDb25maWdQYXRofWApDQoNCiAgICAgIHRyeSB7DQogICAgICAgIGlmICh3aW5kb3cubG9hZGxpdmUyZCkgew0KDQogICAgICAgICAgdGhpcy5saXZlMmRJbnN0YW5jZSA9IHdpbmRvdy5sb2FkbGl2ZTJkKCdsaXZlMmQnLCBtb2RlbENvbmZpZ1BhdGgpDQogICAgICAgIH0gZWxzZSBpZiAod2luZG93LkwyRHdpZGdldCkgew0KICAgICAgICAgIC8vIOWtmOWCqOWunuS+i++8jOeUqOS6juWQjue7remUgOavgQ0KICAgICAgICAgIHRoaXMubGl2ZTJkSW5zdGFuY2UgPSB3aW5kb3cuTDJEd2lkZ2V0LmluaXQoew0KICAgICAgICAgICAgY2FudmFzSWQ6ICdsaXZlMmQnLA0KICAgICAgICAgICAgbW9kZWw6IHsgdXJsOiBtb2RlbENvbmZpZ1BhdGggfSwNCiAgICAgICAgICAgIGRpc3BsYXk6IHsNCiAgICAgICAgICAgICAgcG9zaXRpb246ICdmaXhlZCcsDQogICAgICAgICAgICAgIGJvdHRvbTogJzEwcHgnLA0KICAgICAgICAgICAgICBsZWZ0OiAnMTAwcHgnLA0KICAgICAgICAgICAgICB3aWR0aDogMjAwLCANCiAgICAgICAgICAgICAgaGVpZ2h0OiAyMDANCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBsb2c6IGZhbHNlDQogICAgICAgICAgfSkNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBjb25zb2xlLmVycm9yKCfmnKrmib7liLBMaXZlMkTmoLjlv4NBUEknKQ0KICAgICAgICB9DQogICAgICB9IGNhdGNoIChlcnIpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcignTGl2ZTJE5Yid5aeL5YyW5aSx6LSl77yaJywgZXJyKQ0KICAgICAgICAvLyDliqDovb3lpLHotKXml7bph43nva7liLDpu5jorqTmqKHlnosNCiAgICAgICAgdGhpcy5yZXNldE1vZGVsKCkNCiAgICAgIH0NCiAgICB9LA0KDQogICAgY2hhbmdlTW9kZWwoKSB7DQogICAgICBjb25zdCBtb2RlbElkcyA9IE9iamVjdC5rZXlzKE1PREVMX01BUCkubWFwKE51bWJlcikNCiAgICAgIGNvbnN0IGN1cnJlbnRJbmRleCA9IG1vZGVsSWRzLmluZGV4T2YodGhpcy5tb2RlbElkKQ0KICAgICAgdGhpcy5tb2RlbElkID0gbW9kZWxJZHNbKGN1cnJlbnRJbmRleCArIDEpICUgbW9kZWxJZHMubGVuZ3RoXQ0KICAgICAgdGhpcy50ZXh0dXJlc0lkID0gMA0KICAgICAgdGhpcy5pbml0TGl2ZTJEKCkgLy8g6YeN5paw5Yid5aeL5YyW77yI5Lya5YWI6ZSA5q+B5pen5qih5Z6L77yJDQogICAgfSwNCg0KICAgIGNoYW5nZVRleHR1cmVzKCkgew0KICAgICAgY29uc3QgdGV4dHVyZUlkcyA9IE9iamVjdC5rZXlzKFRFWFRVUkVfTUFQW3RoaXMubW9kZWxJZF0pLm1hcChOdW1iZXIpDQogICAgICBjb25zdCBjdXJyZW50SW5kZXggPSB0ZXh0dXJlSWRzLmluZGV4T2YodGhpcy50ZXh0dXJlc0lkKQ0KICAgICAgdGhpcy50ZXh0dXJlc0lkID0gdGV4dHVyZUlkc1soY3VycmVudEluZGV4ICsgMSkgJSB0ZXh0dXJlSWRzLmxlbmd0aF0NCiAgICAgIHRoaXMuaW5pdExpdmUyRCgpIC8vIOmHjeaWsOWIneWni+WMlu+8iOS8muWFiOmUgOavgeaXp+aooeWei++8iQ0KICAgIH0sDQoNCiAgICByZXNldE1vZGVsKCkgew0KICAgICAgdGhpcy5tb2RlbElkID0gMQ0KICAgICAgdGhpcy50ZXh0dXJlc0lkID0gMA0KICAgICAgdGhpcy5pbml0TGl2ZTJEKCkNCiAgICB9DQogIH0NCn0NCg=="},{"version":3,"sources":["Live2d.vue"],"names":[],"mappings":";;;;;;;;;;;AAWA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Live2d.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n  <div class=\"live2d-wrap\">\r\n    <div class=\"live2d-menu\">\r\n      <span class=\"live2d-menu--item\"><i class=\"el-icon-refresh\" @click=\"changeModel\"></i></span>\r\n      <span class=\"live2d-menu--item\"><i class=\"el-icon-goods\" @click=\"changeTextures\"></i></span>\r\n    </div>\r\n    <canvas id=\"live2d\" width=\"200\" height=\"200\"></canvas>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nconst MODEL_MAP = {\r\n  1: 'live2d-widget-model-gf',\r\n  2: 'live2d-widget-model-hijiki',\r\n}\r\n\r\nconst TEXTURE_MAP = {\r\n  1: { 0: 'Gantzert_Felixander.model.json' }, // 若有实际纹理文件，再替换为真实文件名\r\n  2: { 0: 'hijiki.model.json' }\r\n}\r\n\r\nexport default {\r\n  name: 'Live2d',\r\n  data() {\r\n    return {\r\n      modelId: 1,\r\n      texturesId: 0,\r\n      live2dInstance: null // 存储 Live2D 实例，用于销毁\r\n    };\r\n  },\r\n  mounted() {\r\n    this.loadLive2dScript().then(() => {\r\n      this.initLive2D()\r\n    }).catch(err => {\r\n      console.error('Live2D脚本加载失败：', err)\r\n    })\r\n  },\r\n  // 组件卸载时销毁模型，避免内存泄漏\r\n  beforeUnmount() {\r\n    this.destroyLive2D()\r\n  },\r\n  methods: {\r\n    loadLive2dScript() {\r\n      return new Promise((resolve, reject) => {\r\n        if (window.loadlive2d || window.L2Dwidget) {\r\n          resolve()\r\n          return\r\n        }\r\n        const script = document.createElement('script')\r\n        script.src = '/static/live2dw/lib/L2Dwidget.min.js'\r\n        script.type = 'text/javascript'\r\n        script.async = false\r\n        script.onload = () => resolve()\r\n        script.onerror = (err) => reject(err)\r\n        document.body.appendChild(script)\r\n      })\r\n    },\r\n\r\n    destroyLive2D() {\r\n      if (this.live2dInstance) {\r\n        // 兼容不同版本的销毁方法\r\n        if (this.live2dInstance.destroy) {\r\n          this.live2dInstance.destroy()\r\n        } else if (window.L2Dwidget && window.L2Dwidget.destroy) {\r\n          window.L2Dwidget.destroy('live2d')\r\n        }\r\n        this.live2dInstance = null\r\n      }\r\n      // 清空画布，避免残留\r\n      const canvas = document.getElementById('live2d')\r\n      if (canvas) {\r\n        const ctx = canvas.getContext('2d')\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height)\r\n      }\r\n    },\r\n\r\n    initLive2D() {\r\n      // 先销毁旧模型，再初始化新模型（核心修复）\r\n      this.destroyLive2D()\r\n\r\n      const canvas = document.getElementById('live2d')\r\n      if (!canvas) {\r\n        console.error('未找到Live2D画布！')\r\n        return\r\n      }\r\n\r\n      const modelFolder = MODEL_MAP[this.modelId]\r\n      const textureFile = TEXTURE_MAP[this.modelId][this.texturesId]\r\n      const modelConfigPath = `/public/static/live2dw/${modelFolder}/assets/${textureFile}`\r\n\r\n\r\n      console.log(`当前加载模型：ID=${this.modelId}，路径=${modelConfigPath}`)\r\n\r\n      try {\r\n        if (window.loadlive2d) {\r\n\r\n          this.live2dInstance = window.loadlive2d('live2d', modelConfigPath)\r\n        } else if (window.L2Dwidget) {\r\n          // 存储实例，用于后续销毁\r\n          this.live2dInstance = window.L2Dwidget.init({\r\n            canvasId: 'live2d',\r\n            model: { url: modelConfigPath },\r\n            display: {\r\n              position: 'fixed',\r\n              bottom: '10px',\r\n              left: '100px',\r\n              width: 200, \r\n              height: 200\r\n            },\r\n            log: false\r\n          })\r\n        } else {\r\n          console.error('未找到Live2D核心API')\r\n        }\r\n      } catch (err) {\r\n        console.error('Live2D初始化失败：', err)\r\n        // 加载失败时重置到默认模型\r\n        this.resetModel()\r\n      }\r\n    },\r\n\r\n    changeModel() {\r\n      const modelIds = Object.keys(MODEL_MAP).map(Number)\r\n      const currentIndex = modelIds.indexOf(this.modelId)\r\n      this.modelId = modelIds[(currentIndex + 1) % modelIds.length]\r\n      this.texturesId = 0\r\n      this.initLive2D() // 重新初始化（会先销毁旧模型）\r\n    },\r\n\r\n    changeTextures() {\r\n      const textureIds = Object.keys(TEXTURE_MAP[this.modelId]).map(Number)\r\n      const currentIndex = textureIds.indexOf(this.texturesId)\r\n      this.texturesId = textureIds[(currentIndex + 1) % textureIds.length]\r\n      this.initLive2D() // 重新初始化（会先销毁旧模型）\r\n    },\r\n\r\n    resetModel() {\r\n      this.modelId = 1\r\n      this.texturesId = 0\r\n      this.initLive2D()\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"stylus\">\r\n.live2d-wrap\r\n  position fixed\r\n  left 0\r\n  bottom 10px\r\n  width 100px\r\n  z-index 999\r\n  overflow hidden\r\n.live2d-wrap:hover .live2d-menu\r\n  display flex\r\n\r\n.live2d-menu\r\n  position absolute\r\n  top 0px\r\n  left 10px\r\n  display none\r\n  flex-direction column\r\n  align-items center\r\n  justify-content space-around\r\n  width 40px\r\n  height 80px\r\n  padding 8px\r\n  background-color #fff\r\n  border-radius 20px\r\n  box-shadow 0 2px 10px rgba(0,0,0,0.1)\r\n\r\n.live2d-menu--item\r\n  padding 4px\r\n  cursor pointer\r\n  color #666\r\n  &:hover\r\n    color #409eff\r\n</style>"]}]}