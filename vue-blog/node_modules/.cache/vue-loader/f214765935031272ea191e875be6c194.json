{"remainingRequest":"D:\\githubdesk\\Movie-Recommendation\\vue-blog\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\githubdesk\\Movie-Recommendation\\vue-blog\\src\\views\\Column.vue?vue&type=style&index=0&id=c06969e0&lang=stylus&scoped=true&","dependencies":[{"path":"D:\\githubdesk\\Movie-Recommendation\\vue-blog\\src\\views\\Column.vue","mtime":1763195953223},{"path":"D:\\githubdesk\\Movie-Recommendation\\vue-blog\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\githubdesk\\Movie-Recommendation\\vue-blog\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\githubdesk\\Movie-Recommendation\\vue-blog\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\githubdesk\\Movie-Recommendation\\vue-blog\\node_modules\\stylus-loader\\index.js","mtime":1519606876000},{"path":"D:\\githubdesk\\Movie-Recommendation\\vue-blog\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\githubdesk\\Movie-Recommendation\\vue-blog\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCg0KLy8g5Li76aKY5Y+Y6YeP77yI5LiO572R56uZ57uf5LiA77yJDQokcHJpbWFyeSA9ICNFNTA5MTQNCiRsaWdodC1ibGFjayA9ICMyNTI1MjUgLy8g5rWF6buR6IOM5pmvDQokbGlnaHRlci1ibGFjayA9ICMzMzMzMzMgLy8g5pu05rWF6buR6ImyDQokbGlnaHQgPSAjRjhGOEY4IC8vIOa1heiJsuaWh+Wtlw0KJGdyYXkgPSAjQUFBQUFBIC8vIOasoee6p+aWh+Wtlw0KJHRyYW5zaXRpb24gPSBhbGwgMC4ycyBlYXNlDQoNCi8vIOetm+mAieWuueWZqA0KLm1vdmllLWZpbHRlcg0KICBiYWNrZ3JvdW5kLWNvbG9yOiAkbGlnaHRlci1ibGFjaw0KICBib3JkZXItcmFkaXVzOiA4cHgNCiAgcGFkZGluZzogMjBweA0KICBtYXJnaW46IDIwcHggMA0KICBib3gtc2hhZG93OiAwIDNweCAxMHB4IHJnYmEoMCwwLDAsMC4yKQ0KDQovLyDljZXkuKrnrZvpgInnu4QNCi5maWx0ZXItZ3JvdXANCiAgbWFyZ2luLWJvdHRvbTogMjVweA0KICAmOmxhc3Qtb2YtdHlwZQ0KICAgIG1hcmdpbi1ib3R0b206IDANCg0KLy8g562b6YCJ5qCH562+77yI5bm05Lu9L+exu+Wei++8iQ0KLmZpbHRlci1sYWJlbA0KICBmb250LXNpemU6IDE4cHgNCiAgZm9udC13ZWlnaHQ6IDYwMA0KICBjb2xvcjogJHByaW1hcnkNCiAgbWFyZ2luLWJvdHRvbTogMTVweA0KICBkaXNwbGF5OiBibG9jaw0KDQovLyDnrZvpgInpgInpobnlrrnlmagNCi5maWx0ZXItb3B0aW9ucw0KICBkaXNwbGF5OiBmbGV4DQogIGZsZXgtd3JhcDogd3JhcA0KICBnYXA6IDEycHgNCg0KLy8g562b6YCJ6YCJ6aG577yI5qCH562+5byP77yJDQouZmlsdGVyLW9wdGlvbg0KICBwYWRkaW5nOiA4cHggMTZweA0KICBiYWNrZ3JvdW5kLWNvbG9yOiAkbGlnaHQtYmxhY2sNCiAgYm9yZGVyLXJhZGl1czogMjBweA0KICBjb2xvcjogJGxpZ2h0DQogIGZvbnQtc2l6ZTogMTRweA0KICBjdXJzb3I6IHBvaW50ZXINCiAgdHJhbnNpdGlvbjogJHRyYW5zaXRpb24NCiAgYm9yZGVyOiAxcHggc29saWQgdHJhbnNwYXJlbnQNCiAgJjpob3Zlcg0KICAgIGJhY2tncm91bmQtY29sb3I6ICM0NDQNCiAgICBjb2xvcjogJHByaW1hcnkNCiAgLy8g6YCJ5Lit54q25oCB77yI5Y+C6ICD56S65L6L57qi6Imy6IOM5pmv77yJDQogICYuYWN0aXZlDQogICAgYmFja2dyb3VuZC1jb2xvcjogJHByaW1hcnkNCiAgICBjb2xvcjogd2hpdGUNCiAgICBib3JkZXItY29sb3I6ICRwcmltYXJ5DQogICAgJjpob3Zlcg0KICAgICAgYmFja2dyb3VuZC1jb2xvcjogI0MwMDgxMg0KDQovLyDlk43lupTlvI/pgILphY0NCkBtZWRpYSAobWF4LXdpZHRoOiA3NjhweCkgDQogIC5tb3ZpZS1maWx0ZXINCiAgICBwYWRkaW5nOiAxNXB4DQogIC5maWx0ZXItbGFiZWwNCiAgICBmb250LXNpemU6IDE2cHgNCiAgLmZpbHRlci1vcHRpb24NCiAgICBwYWRkaW5nOiA2cHggMTJweA0KICAgIGZvbnQtc2l6ZTogMTNweA0KICAuZmlsdGVyLW9wdGlvbnMNCiAgICBnYXA6IDhweA0KICANCg=="},{"version":3,"sources":["Column.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqSA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Column.vue","sourceRoot":"src/views","sourcesContent":["<template>\r\n  <div class=\"movie-filter\">\r\n    <!-- 年份筛选 -->\r\n    <div class=\"filter-group\">\r\n      <div class=\"filter-label\">年份</div>\r\n      <div class=\"filter-options\">\r\n        <span v-for=\"year in yearOptions\" :key=\"year.value\"\r\n          :class=\"['filter-option', { active: selectedOptions.year === year.label }]\"\r\n          @click=\"handleFilterSelect('year', year.label, year.value)\">\r\n          {{ year.label }}\r\n        </span>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- 类型筛选（关联columns分类数据） -->\r\n    <div class=\"filter-group\">\r\n      <div class=\"filter-label\">类型</div>\r\n      <div class=\"filter-options\">\r\n        <span v-for=\"item in columnWords\" :key=\"item.value\"\r\n          :class=\"['filter-option', { active: selectedType === item.id }]\"\r\n          @click=\"handleFilterSelect('type', item.label, item.id)\">\r\n          {{ item.name }}\r\n        </span>\r\n      </div>\r\n    </div>\r\n    <div class=\"blog-content\" v-if=\"!show404 && movies\">\r\n      <div class=\"blog-content--item\" v-for=\"item in movies\" :key=\"item.id\">\r\n        <router-link :to=\"{ name: 'movie', params: { id: item._id } }\">\r\n          <MovieItem :movie=\"item\" />\r\n        </router-link>\r\n      </div>\r\n    </div>\r\n    <div class=\"base404\" v-else>\r\n      <Base404  />\r\n\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport MovieItem from '@/components/movie/MovieItem'\r\nimport Base404 from '@/components/base/Base404.vue';\r\nimport QS from 'qs'\r\nexport default {\r\n  name: 'MovieFilter',\r\n  inject: ['closeLoadClock'],\r\n  data() {\r\n    return {\r\n      // 年份选项（2000-2025，包含区间）\r\n      yearOptions: [\r\n        { label: '全部', value: null },\r\n        { label: '2025', value: '2025' },\r\n        { label: '2024', value: '2024' },\r\n        { label: '2023', value: '2023' },\r\n        { label: '2022', value: '2022' },\r\n        { label: '2021', value: '2021' },\r\n        { label: '2020', value: '2020' },\r\n        { label: '2010-2019', value: '2010-2019', start: 2010, end: 2019 },\r\n        { label: '2000-2009', value: '2000-2009', start: 2000, end: 2009 }\r\n      ],\r\n      // 选中的筛选条件\r\n      selectedOptions: {\r\n        year: '全部',\r\n        type: ''\r\n      },\r\n      selectedYear: null,\r\n      selectedType: '',\r\n      columns: [],\r\n      movies: [],\r\n      // 添加缺失的属性\r\n      size: 20,\r\n      page: 1,\r\n      show404: false,\r\n      query: {\r\n        column: '',\r\n        date: ''\r\n      }\r\n    };\r\n  },\r\n  components: {\r\n    MovieItem, Base404\r\n  },\r\n  activated() {\r\n    if (this.$route.query?.columnId) {\r\n      this.query.column = this.$route.query?.columnId\r\n    }\r\n  },\r\n\r\n  deactivated() {\r\n    this.query = {\r\n      column: '',\r\n      date: '',\r\n    }\r\n  },\r\n  created() {\r\n    this.getColumns()\r\n    this.getMovies()\r\n  },\r\n  mounted() {\r\n    this.$EventBus.$on('updateView', () => {\r\n      this.getColumns()\r\n      this.getMovies()\r\n    })\r\n  },\r\n  watch: {\r\n    $route: {\r\n      handler() {\r\n        this.handleRouteChange()\r\n\r\n      },\r\n\r\n      immediate: true\r\n    }\r\n  },\r\n  computed: {\r\n    columnWords() {\r\n      return this.columns.map(item => {\r\n\r\n        return {\r\n          name: item.name,\r\n          value: item.aids.length || 0,\r\n          id: item._id\r\n        }\r\n      })\r\n    },\r\n\r\n  },\r\n  methods: {\r\n    async wordClickHandler(name) {\r\n\r\n      // let columnId = this.columns.find(item => {\r\n      //   return item.name === name\r\n      // })?._id\r\n      // console.log(this.$store.state.userInfo)\r\n      // if (!this.$store.state.userInfo) {\r\n      //   try {\r\n      //     await this.$store.dispatch('getUserInfo')\r\n      //     // 再次检查是否获取到用户信息\r\n      //     if (!this.$store.state.userInfo) {\r\n      //       this.$notify.warning({\r\n      //         title: '提示',\r\n      //         message: '请先登录以获取完整功能'\r\n      //       })\r\n      //       // 可以选择是否继续跳转\r\n      //     }\r\n      //   } catch (err) {\r\n      //     this.$notify.error({\r\n      //       title: '错误',\r\n      //       message: '获取用户信息失败，请稍后重试'\r\n      //     })\r\n      //     return // 获取失败则不继续\r\n      //   }\r\n      // }\r\n      // console.log(columnId)\r\n\r\n      // this.$router.push({ name: 'index', query: { columnId: columnId } })\r\n    },\r\n\r\n\r\n    async getColumns() {\r\n      try {\r\n        let columns = await this.$api({ type: 'columns' })\r\n        this.columns = columns.list\r\n      } catch (err) {\r\n        console.log(err)\r\n      }\r\n    },\r\n\r\n    // 筛选选择处理\r\n    async handleFilterSelect(type, label, value) {\r\n      if (type === 'year') {\r\n        // 检查是否为区间值\r\n        this.selectedOptions.year = label;\r\n        if (value && value.includes('-')) {\r\n          this.selectedYear = value;\r\n        } else if (value) {\r\n          // 单一年份值\r\n          this.selectedYear = parseInt(value);\r\n        } else {\r\n          // 全部或其他空值\r\n          this.selectedOptions.year = label;\r\n\r\n          this.selectedYear = value;\r\n        }\r\n      } else if (type === 'type') {\r\n        this.selectedType = value;\r\n      }\r\n      // 触发筛选变化\r\n      await this.emitFilterChange();\r\n    },\r\n    // 发送筛选条件\r\n    async emitFilterChange() {\r\n      const filters = {\r\n        date: this.selectedYear,\r\n        columnId: this.selectedType\r\n      };\r\n\r\n      this.$router.push({ name: 'column', query: filters });\r\n    },\r\n    handleRouteChange() {\r\n      // 检查查询参数是否发生变化\r\n      const newColumn = this.$route.query?.columnId || '';\r\n      const newDate = this.$route.query?.date || undefined;\r\n\r\n      // 如果查询参数发生了变化，重新加载数据\r\n      if (this.query.column !== newColumn || this.query.date !== newDate) {\r\n        console.log('查询参数发生了变化，重新加载数据');\r\n        this.query.column = newColumn;\r\n        this.query.date = newDate;\r\n        this.cancelMovies();\r\n        console.log('加载电影列表');\r\n        this.getMovies();\r\n        console.log('加载完成')\r\n      }\r\n    },\r\n\r\n    getMovies() {\r\n      console.log('开始加载电影列表')\r\n      let data = { size: this.size, page: this.page }\r\n      let query = this.setQuery()\r\n      if (Object.entries(query).length > 0) {\r\n        data.query = QS.stringify(query)\r\n      }\r\n      console.log(data)\r\n      this.$api({ type: 'movies', data }).then(result => {\r\n        // 关键修改：在这里判断是否显示404页面\r\n        if (result.list.length === 0 && this.page === 1) {\r\n          this.show404 = true;\r\n          this.movies = [];\r\n        } else if (this.movies.length >= result.total) {\r\n          // 没有更多了\r\n          console.log('没有更多了')\r\n          return\r\n        } else {\r\n          // 正常显示文章\r\n          this.show404 = false;\r\n          this.movies.push(...result.list)\r\n          console.log(this.movies)\r\n          this.closeLoadClock() //调用父组件provide传递的关闭load锁方法\r\n          this.page++\r\n        }\r\n      }).catch(err => {\r\n        this.$notify.error({\r\n          title: '获取失败',\r\n          message: err.message\r\n        })\r\n      })\r\n    },\r\n\r\n    setQuery() {\r\n      const date = this.$route.query?.date ? String(this.$route.query.date) : undefined;\r\n      const column = this.$route.query?.columnId || undefined;\r\n\r\n      let query = {};\r\n\r\n      // 处理栏目筛选\r\n      if (column) {\r\n        query.column = column;\r\n      }\r\n\r\n      // 处理年份筛选\r\n      if (date) {\r\n        // 检查是否为区间值\r\n        if (date.includes('-')) {\r\n          // 解析区间值，如 '2010-2019'\r\n          const [start, end] = date.split('-').map(Number);\r\n          query.date = {\r\n            $gte: start,  // 大于等于开始年份\r\n            $lte: end     // 小于等于结束年份\r\n          };\r\n        } else {\r\n          // 单一年份\r\n          const year = parseInt(date);\r\n          if (!isNaN(year)) {\r\n            query.date = year;\r\n          }\r\n        }\r\n      }\r\n\r\n      return query;\r\n    },\r\n\r\n    cancelMovies() {\r\n      this.page = 1\r\n      this.movies = []\r\n    },\r\n  },\r\n\r\n\r\n};\r\n</script>\r\n\r\n<style lang=\"stylus\" scoped>\r\n// 主题变量（与网站统一）\r\n$primary = #E50914\r\n$light-black = #252525 // 浅黑背景\r\n$lighter-black = #333333 // 更浅黑色\r\n$light = #F8F8F8 // 浅色文字\r\n$gray = #AAAAAA // 次级文字\r\n$transition = all 0.2s ease\r\n\r\n// 筛选容器\r\n.movie-filter\r\n  background-color: $lighter-black\r\n  border-radius: 8px\r\n  padding: 20px\r\n  margin: 20px 0\r\n  box-shadow: 0 3px 10px rgba(0,0,0,0.2)\r\n\r\n// 单个筛选组\r\n.filter-group\r\n  margin-bottom: 25px\r\n  &:last-of-type\r\n    margin-bottom: 0\r\n\r\n// 筛选标签（年份/类型）\r\n.filter-label\r\n  font-size: 18px\r\n  font-weight: 600\r\n  color: $primary\r\n  margin-bottom: 15px\r\n  display: block\r\n\r\n// 筛选选项容器\r\n.filter-options\r\n  display: flex\r\n  flex-wrap: wrap\r\n  gap: 12px\r\n\r\n// 筛选选项（标签式）\r\n.filter-option\r\n  padding: 8px 16px\r\n  background-color: $light-black\r\n  border-radius: 20px\r\n  color: $light\r\n  font-size: 14px\r\n  cursor: pointer\r\n  transition: $transition\r\n  border: 1px solid transparent\r\n  &:hover\r\n    background-color: #444\r\n    color: $primary\r\n  // 选中状态（参考示例红色背景）\r\n  &.active\r\n    background-color: $primary\r\n    color: white\r\n    border-color: $primary\r\n    &:hover\r\n      background-color: #C00812\r\n\r\n// 响应式适配\r\n@media (max-width: 768px) \r\n  .movie-filter\r\n    padding: 15px\r\n  .filter-label\r\n    font-size: 16px\r\n  .filter-option\r\n    padding: 6px 12px\r\n    font-size: 13px\r\n  .filter-options\r\n    gap: 8px\r\n  \r\n</style>"]}]}